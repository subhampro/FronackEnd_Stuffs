<!--
    üéÆ FiveM Guidebook Admin UI
    --------------------------
    Created with coffee and determination ‚òï
    
    If you're reading this, you're probably:
    1. A developer trying to fix something
    2. Someone who got lost in the code
    3. Just really curious
    
    Either way, welcome! Just remember:
    - Each section is documented (hopefully clearly)
    - The UI is modular and responsive
    - Everything is customizable (don't break it though)
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guidebook Admin</title>
    <!-- We're using Quill for our rich text editor -->
    <link rel="stylesheet" href="https://cdn.quilljs.com/1.3.6/quill.snow.css">
    <style>
        :root {
            --primary-color: #00f7ff;
            --secondary-color: #0a1929;
            --accent-color: #ff00f7;
            --text-color: #ffffff;
            --sidebar-width: 15%;
            --sidebar-width-tablet: 25%;
            --sidebar-width-mobile: 75%;
            --admin-accent: #ffd700;
        }

        body {
            background: linear-gradient(45deg, #000000, #1a1a1a);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Segoe UI', sans-serif;
            color: var(--text-color);
            overflow: hidden;
        }

        .tablet-frame {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 30px;
            box-shadow: 0 0 0 10px #1a1a1a, 0 20px 40px rgba(0, 0, 0, 0.8);
            position: relative;
            animation: frameAppear 1s ease-out;
        }

        .tablet-frame::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 3px;
            height: 80px;
            background: #1a1a1a;
            box-shadow: inset 0 0 5px rgba(0, 247, 255, 0.3);
            border-radius: 3px;
            transform: translateY(-50%);
        }

        .tablet-frame::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 15px;
            height: 15px;
            background: #222;
            border-radius: 50%;
        }

        .tablet-container {
            background: var(--secondary-color);
            width: 95vw;
            height: 90vh;
            border-radius: 20px;
            box-shadow: 0 0 20px var(--primary-color);
            display: flex;
            position: relative;
            overflow: hidden;
            border: 2px solid var(--primary-color);
            animation: powerOn 1s ease-out;
            backdrop-filter: blur(10px);
        }

        /* Admin-specific overrides and additions */
        .admin-badge {
            position: relative;
            top: -10px;
            right: -5px;
            background: linear-gradient(135deg, var(--admin-accent), #ff6b00);
            color: var(--secondary-color);
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 0.6em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: badgePulse 2s infinite, badgeFloat 3s ease-in-out infinite;
        }

        .admin-badge:hover {
            transform: translateY(-2px) scale(1.1);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        @keyframes badgePulse {
            0% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
        }

        @keyframes badgeFloat {
            0% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
            100% { transform: translateY(0); }
        }

        /* Form styles */
        .form-group {
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(10, 25, 41, 0.3);
            border-radius: 5px;
            border: 1px solid rgba(0, 247, 255, 0.1);
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary-color);
            font-size: 0.9em;
        }

        .form-control {
            width: 100%;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--primary-color);
            color: var(--text-color);
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            background: rgba(0, 247, 255, 0.1);
            outline: none;
            box-shadow: 0 0 10px rgba(0, 247, 255, 0.2);
        }

        .btn-primary {
            background: rgba(0, 247, 255, 0.1);
            color: var(--primary-color);
            padding: 10px 20px;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--primary-color);
            color: var(--secondary-color);
            box-shadow: 0 0 15px var(--primary-color);
        }

        /* Editor container */
        #editor-container {
            height: 300px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        .ql-toolbar {
            background: rgba(10, 25, 41, 0.5);
            border-color: var(--primary-color) !important;
            border-radius: 5px 5px 0 0;
        }

        .ql-container {
            border-color: var(--primary-color) !important;
            border-radius: 0 0 5px 5px;
            background: rgba(10, 25, 41, 0.3);
        }

        .range-slider {
            width: 100%;
            margin: 10px 0;
            background: rgba(0, 247, 255, 0.1);
            height: 4px;
            appearance: none;
            -webkit-appearance: none;
            border-radius: 2px;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .range-slider::-webkit-slider-thumb:hover {
            box-shadow: 0 0 10px var(--primary-color);
        }

        .color-picker {
            width: 50px;
            height: 30px;
            padding: 0;
            border: 2px solid var(--primary-color);
            border-radius: 4px;
            cursor: pointer;
            background: transparent;
        }

        .header-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 160px 15px 15px; /* Increased right padding for buttons */
            background: rgba(0, 247, 255, 0.05);
            border-radius: 5px 70px 70px 5px; /* Rounded right side */
            border-left: 3px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        .header-actions::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            width: 140px;
            height: 100%;
            background: radial-gradient(
                circle at right center,
                rgba(0, 247, 255, 0.1) 0%,
                transparent 70%
            );
            animation: glowPulse 2s infinite;
        }

        @keyframes glowPulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        .tip {
            color: var(--primary-color);
            font-size: 0.85em;
            opacity: 0.8;
            margin: 5px 0 25px 0; /* Added 25px bottom margin */
            padding-left: 10px;
            border-left: 2px solid var(--primary-color);
        }

        #font-preview {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 247, 255, 0.05);
            border-radius: 4px;
            text-align: center;
        }

        #sidebar {
            width: 15%;
            background: rgba(10, 25, 41, 0.9);
            padding: 20px;
            border-right: 1px solid var(--primary-color);
            animation: slideIn 0.5s ease-out;
        }

        #main {
            width: 85%;
            padding: 30px;
            background: rgba(10, 25, 41, 0.7);
            overflow-y: auto;
            animation: fadeIn 0.5s ease-out;
            box-sizing: border-box; /* Include padding in width calculation */
        }

        .category {
            padding: 10px;
            position: relative;
            margin-bottom: 5px;
        }

        .category h2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0;
            font-size: 0.9em;
            line-height: 1.2;
        }

        .dropdown-arrow {
            color: var(--primary-color);
            font-size: 0.8em;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.7;
        }

        .category.active {
            background: rgba(0, 247, 255, 0.1);
            margin-bottom: 10px;
        }

        .category.active .dropdown-arrow {
            transform: rotate(180deg);
            opacity: 1;
        }

        .category:hover {
            background: rgba(0, 247, 255, 0.2);
            transform: translateX(5px);
        }

        .subcategory {
            margin-top: 5px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
        }

        .subcategory.open {
            max-height: 300px;
            opacity: 1;
        }

        .page {
            margin: 3px 0;
            padding: 8px 10px;
            border-left: 2px solid var(--primary-color);
            transform: translateY(-10px);
            opacity: 0;
            transition: all 0.3s ease;
            background: rgba(0, 247, 255, 0.03);
            font-size: 0.9em;
        }

        @media screen and (max-width: 1200px) {
            .tablet-container {
                width: 98vw;
            }

            #sidebar {
                width: var(--sidebar-width-tablet);
            }

            #main {
                width: calc(100% - var(--sidebar-width-tablet));
            }
        }

        @media screen and (max-width: 768px) {
            .tablet-frame {
                padding: 10px;
            }

            .tablet-container {
                width: 100vw;
                height: 100vh;
                border-radius: 15px;
            }

            #sidebar {
                width: var(--sidebar-width-mobile);
                position: absolute;
                left: -75%;
                height: 100%;
                transition: left 0.3s ease;
                z-index: 10;
            }

            #sidebar.active {
                left: 0;
            }

            #main {
                width: 100%;
            }

            .menu-toggle {
                display: block;
            }
        }

        .menu-toggle {
            display: none;
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 20;
            color: var(--primary-color);
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        @keyframes powerOn {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes frameAppear {
            0% { 
                opacity: 0;
                transform: translateY(50px);
            }
            100% { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            0% {
                transform: translateY(-10px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 247, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 5px;
        }

        @media screen and (max-width: 1200px) {
        }

        @media screen and (max-width: 768px) {
        }

        @media screen and (max-width: 480px) {
        }

        .controls {
            position: absolute;
            top: 15px;
            right: 35px; /* Moved buttons more to the right */
            display: flex;
            gap: 12px;
            z-index: 100;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            background: rgba(10, 25, 41, 0.8);
            color: var(--primary-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(5px);
            transform: scale(1);
        }

        .control-btn:hover {
            background: var(--primary-color);
            color: var(--secondary-color);
            box-shadow: 0 0 15px var(--primary-color);
            transform: scale(1.1);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        /* Mobile responsive controls */
        @media screen and (max-width: 768px) {
            .controls {
                top: 10px;
                right: 25px;
                gap: 8px;
            }

            .control-btn {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }

        .dropdown-arrow,
        .category.active .dropdown-arrow,
        .subcategory,
        .subcategory.open {
            display: none;
        }

        .category:hover {
            background: rgba(0, 247, 255, 0.2);
            transform: translateX(5px);
            cursor: pointer;
        }

        .zoom-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
        }

        .tablet-container * {
            transition: all 0.3s ease;
        }

        /* Form layout improvements */
        .form-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(10, 25, 41, 0.3);
            border-radius: 5px;
            border: 1px solid rgba(0, 247, 255, 0.1);
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-control {
            width: calc(100% - 16px); /* Account for padding */
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--primary-color);
            color: var(--text-color);
            border-radius: 4px;
            transition: all 0.3s ease;
            font-size: 0.9em;
            max-width: 100%;
            box-sizing: border-box;
        }

        .range-slider {
            width: calc(100% - 16px);
        }

        /* Editor specific adjustments */
        .editor-wrapper {
            grid-column: 1 / -1;
            margin-top: 20px;
            width: 80%;  /* Match text-appearance-controls width */
            max-width: 1000px;
        }

        #editor-container {
            height: 300px;
            margin-bottom: 20px;
        }

        /* Adjustments for mobile */
        @media screen and (max-width: 768px) {
            .form-container {
                grid-template-columns: 1fr;
            }
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            width: 100%;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
            min-width: 200px; /* Ensure minimum width for inputs */
        }

        .form-row .form-group.small {
            flex: 0 0 120px;
        }

        .enable-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(0, 247, 255, 0.05);
            border-radius: 20px;
            border: 1px solid var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .enable-toggle:hover {
            background: rgba(0, 247, 255, 0.1);
        }

        .enable-toggle input[type="checkbox"] {
            width: 0;
            height: 0;
            opacity: 0;
            position: absolute;
        }

        .enable-toggle .toggle-slider {
            width: 36px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            display: inline-block;
            border-radius: 20px;
            position: relative;
            transition: 0.3s;
        }

        .enable-toggle .toggle-slider:before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--text-color);
            top: 2px;
            left: 2px;
            transition: 0.3s;
        }

        .enable-toggle input:checked + .toggle-slider {
            background: var(--primary-color);
        }

        .enable-toggle input:checked + .toggle-slider:before {
            transform: translateX(16px);
            background: var(--secondary-color);
        }

        .page-header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .text-appearance-controls {
            background: rgba(0, 247, 255, 0.05);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--primary-color);
            margin-bottom: 30px;
            width: 80%;  /* Reduced width */
            max-width: 1000px;  /* Maximum width */
            box-sizing: border-box;
            box-shadow: 0 0 20px rgba(0, 247, 255, 0.1);
        }

        .text-appearance-controls .form-row {
            margin-bottom: 25px;  /* Increased spacing between rows */
        }

        .text-appearance-controls .form-group {
            background: rgba(10, 25, 41, 0.5);  /* Slightly darker background */
            border: 1px solid rgba(0, 247, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
        }

        .text-font-group {
            flex: 2;
        }

        .text-color-group {
            flex: 1;
        }

        .color-preview-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .color-picker {
            width: 60px;
            height: 60px;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            cursor: pointer;
            background: transparent;
            transition: all 0.3s ease;
        }

        .color-picker:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--primary-color);
        }

        .color-preview {
            flex: 1;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid var(--primary-color);
            text-align: center;
            font-size: 0.9em;
        }

        #font-preview {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 247, 255, 0.05);
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--primary-color);
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        #font-preview:hover {
            background: rgba(0, 247, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 247, 255, 0.2);
        }

        #font-select {
            margin-bottom: 10px;
        }

        .page-form-header {
            display: flex;
            gap: 20px;
            align-items: center;
            width: 100%;
        }

        .page-form-header .form-group {
            margin-bottom: 0;
        }

        .page-form-header .form-group:nth-child(1) { /* Category select */
            flex: 2;
        }

        .page-form-header .form-group:nth-child(2) { /* Page Label */
            flex: 2;
        }

        .page-form-header .form-group:nth-child(3) { /* Key */
            flex: 2;
        }

        .page-form-header .form-group:nth-child(4) { /* Order */
            flex: 0 0 80px;
        }

        .page-list, .points-list {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 247, 255, 0.05);
            border-radius: 10px;
            border: 1px solid var (--primary-color);
        }

        .page-item, .point-item {
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(10, 25, 41, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(0, 247, 255, 0.2);
        }

        /* Update/Add these responsive styles */
        @media screen and (max-width: 1200px) {
            .text-appearance-controls {
                width: 90%;
            }

            .form-row {
                flex-direction: column;
            }

            .form-row .form-group {
                width: 100%;
            }

            .page-form-header {
                flex-direction: column;
                gap: 10px;
            }

            .page-form-header .form-group {
                width: 100%;
            }
        }

        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }

            .tablet-frame {
                padding: 10px;
            }

            .tablet-container {
                width: 100vw;
                height: 100vh;
            }

            #sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                width: 80%;
                height: 100%;
                z-index: 1000;
                transition: left 0.3s ease;
            }

            #sidebar.active {
                left: 0;
            }

            #main {
                width: 100%;
                padding: 15px;
            }

            .menu-toggle {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1001;
            }

            .controls {
                right: 10px;
                top: 10px;
            }

            .text-appearance-controls {
                width: 100%;
                padding: 15px;
            }

            .header-actions {
                padding: 10px;
                margin-bottom: 20px;
            }

            .header-actions h2 {
                font-size: 1.2em;
            }

            .color-preview-container {
                flex-direction: column;
            }
        }

        @media screen and (max-width: 480px) {
            .tablet-frame::before,
            .tablet-frame::after {
                display: none;
            }

            .control-btn {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }

            .form-container {
                padding: 10px;
            }

            .text-appearance-controls {
                padding: 10px;
            }

            h1 {
                font-size: 1.2em;
            }

            .admin-badge {
                font-size: 0.5em;
            }

            .btn-primary {
                padding: 8px 15px;
                font-size: 0.9em;
            }
        }

        /* Add backdrop for mobile menu */
        .sidebar-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        #sidebar.active + .sidebar-backdrop {
            display: block;
        }

        /* New/Updated Category Listing Styles */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .category-item {
            background: rgba(10, 25, 41, 0.6);
            border: 1px solid var(--primary-color);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .category-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 247, 255, 0.1);
        }

        .category-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-color);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .category-item:hover::before {
            transform: scaleY(1);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .category-title {
            font-size: 1.2em;
            margin: 0;
            color: var(--primary-color);
        }

        .category-edit {
            background: rgba(0, 247, 255, 0.1);
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 5px 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .category-edit:hover {
            background: var(--primary-color);
            color: var(--secondary-color);
            box-shadow: 0 0 15px var(--primary-color);
        }

        .category-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .stat-item {
            background: rgba(0, 247, 255, 0.05);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .stat-item i {
            color: var(--primary-color);
            margin-right: 5px;
        }

        @media screen and (max-width: 768px) {
            .categories-grid {
                grid-template-columns: 1fr;
            }
        }

        /* New Pages List Styles */
        .category-section {
            margin: 30px 0;
        }

        .category-section-header {
            color: var(--primary-color);
            font-size: 1.2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .category-section-header::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--primary-color);
            opacity: 0.3;
        }

        .pages-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .page-item {
            display: flex;
            align-items: center;
            gap: 15px; /* Add consistent gap between elements */
            padding: 15px;
            background: rgba(10, 25, 41, 0.6);
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .page-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 247, 255, 0.1);
        }

        .page-name {
            flex: 2;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center; /* Center vertically */
        }

        .page-slug {
            flex: 1;
            font-size: 0.8em;
            padding: 5px 10px;
            background: rgba(0, 247, 255, 0.1);
            border-radius: 4px;
            color: #aaa;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 24px; /* Fixed height */
        }

        .page-category {
            flex: 1;
            font-size: 0.8em;
            padding: 5px 10px;
            background: rgba(255, 0, 247, 0.1);
            border-radius: 4px;
            color: #aaa;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 24px; /* Fixed height */
        }

        .page-order {
            flex: 0 0 60px;
            text-align: center;
            font-size: 0.8em;
            padding: 5px 10px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 4px;
            color: #ffd700;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 24px; /* Fixed height */
        }

        .page-actions {
            display: flex;
            gap: 10px;
            margin-left: 15px;
        }

        .action-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 1px solid var(--primary-color);
            background: rgba(0, 247, 255, 0.1);
            color: var(--primary-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: var(--primary-color);
            color: var(--secondary-color);
            transform: rotate(360deg);
        }

        .action-btn.delete {
            border-color: #ff4747;
            color: #ff4747;
        }

        .action-btn.delete:hover {
            background: #ff4747;
            color: var(--secondary-color);
        }

        .page-status {
            flex: 0 0 100px; /* Fixed width for status */
            font-size: 0.8em;
            padding: 5px 10px;
            border-radius: 4px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 24px; /* Fixed height */
        }

        .page-status.active {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
        }

        .page-status.inactive {
            background: rgba(255, 0, 0, 0.1);
            color: #ff4747;
        }
    </style>
</head>
<body>
    <!-- The admin panel interface -->
    <div class="zoom-wrapper">
        <!-- Our fancy tablet UI -->
        <div class="tablet-frame">
            <!-- Mobile menu button -->
            <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
            <div class="tablet-container">
                <!-- Top control buttons -->
                <div class="controls">
                    <button class="control-btn" id="zoomIn" onclick="zoom(1)">+</button>
                    <button class="control-btn" id="zoomOut" onclick="zoom(-1)">-</button>
                    <button class="control-btn" id="close" onclick="closeGuidebook()">√ó</button>
                </div>
                <!-- Admin navigation sidebar -->
                <div id="sidebar">
                    <h1>Guidebook<sup class="admin-badge">ADMIN</sup></h1>
                    <div class="category" onclick="loadSection('categories')">
                        <h2>üìÅ Categories</h2>
                    </div>
                    <div class="category" onclick="loadSection('pages')">
                        <h2>üìÑ Pages</h2>
                    </div>
                    <div class="category" onclick="loadSection('points')">
                        <h2>üìç Points</h2>
                    </div>
                </div>
                <!-- Content backdrop for mobile -->
                <div class="sidebar-backdrop" onclick="toggleSidebar()"></div>
                <!-- Main content area -->
                <div id="main">
                    <!-- Dynamic content loads here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Let's load our text editor -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        // Keep track of important stuff
        let quill;
        let currentZoom = 100;
        let pageFormMode = 'create';
        let editingPageData = null;

        // Clean up any existing editor before creating a new one
        function cleanupEditor() {
            // Remove any existing toolbar
            const existingToolbars = document.querySelectorAll('.ql-toolbar');
            existingToolbars.forEach(toolbar => toolbar.remove());
            
            // Destroy existing Quill instance if it exists
            if (quill) {
                quill = null;
            }
        }

        // Set up our fancy text editor
        function initializeEditor() {
            // Wait for editor container to exist
            const editorContainer = document.getElementById('editor-container');
            if (!editorContainer) {
                console.warn('Editor container not found');
                return;
            }

            // Clean up before initializing
            cleanupEditor();
            
            // Initialize new Quill instance
            try {
                quill = new Quill('#editor-container', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'font': [] }, { 'size': [] }],
                            ['bold', 'italic', 'underline', 'strike'],
                            [{ 'color': [] }, { 'background': [] }],
                            [{ 'script': 'super' }, { 'script': 'sub' }],
                            [{ 'header': '1' }, { 'header': '2' }, 'blockquote', 'code-block'],
                            [{ 'list': 'ordered' }, { 'list': 'bullet' }, { 'indent': '-1' }, { 'indent': '+1' }],
                            ['link', 'image', 'video'],
                            ['clean']
                        ]
                    },
                    placeholder: 'Start writing...'
                });

                if (quill) {
                    quill.on('text-change', function(delta, oldDelta, source) {
                        if (source === 'user') {
                            // Handle content changes here if needed
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing Quill:', error);
            }
        }

        // Load different sections of the admin panel
        function loadCategoriesSection() {
            const content = `
                <div class="header-actions">
                    <h2>Categories</h2>
                    <button class="btn-primary" onclick="showNewCategoryForm()">+ New Category</button>
                </div>
                <div id="category-form-container" class="form-container" style="display: none;">
                    <div class="text-appearance-controls">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Category Name</label>
                                <input type="text" class="form-control" id="category-name" placeholder="Enter category name">
                            </div>
                        </div>
                        <button class="btn-primary" onclick="submitCategory()">Create Category</button>
                    </div>
                </div>
                <div id="categories-list"></div>
            `;
            document.getElementById('main').innerHTML = content;
            loadCategories();
        }

        // Show the form for creating categories
        function showNewCategoryForm() {
            const formContainer = document.getElementById('category-form-container');
            formContainer.style.display = 'flex';
        }

        // Save category changes to our database
        async function submitCategory() {
            const categoryName = document.getElementById('category-name').value;
            if (categoryName.trim()) {
                const data = await loadFromJSON();
                const newCategory = {
                    id: Date.now().toString(),
                    name: categoryName,
                    pages: []
                };
                
                data.categories.push(newCategory);
                await saveToJSON(data);
                
                document.getElementById('category-name').value = '';
                document.getElementById('category-form-container').style.display = 'none';
                loadCategories();
            } else {
                alert('Please enter a category name');
            }
        }

        // Load and manage pages
        function loadPagesSection() {
            const content = `
                <div class="header-actions">
                    <h2>Pages</h2>
                    <button class="btn-primary" onclick="showNewPageForm('create')">+ New Page</button>
                </div>
                <div id="page-form-container" class="form-container" style="display: none;">
                    <div class="text-appearance-controls">
                        <div class="page-form-header">
                            <div class="form-group">
                                <label>Category</label>
                                <select class="form-control" id="category-select">
                                    <option value="">Select Category</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Page Label</label>
                                <input type="text" class="form-control" id="page-label">
                            </div>
                            <div class="form-group">
                                <label>Key (Slug)</label>
                                <input type="text" class="form-control" id="page-key">
                            </div>
                            <div class="form-group">
                                <label>Order</label>
                                <input type="number" class="form-control" min="1" max="99" id="page-order" value="1">
                            </div>
                        </div>
                        <label class="enable-toggle" style="margin: 20px 0;">
                            <input type="checkbox" id="page-enabled" checked>
                            <span class="toggle-slider"></span>
                            Enable Page
                        </label>
                        <div class="form-group full-width editor-wrapper">
                            <label>Content</label>
                            <div id="editor-container"></div>
                        </div>
                        <div id="page-form-buttons">
                            <button class="btn-primary" id="page-submit-btn" onclick="handlePageSubmit()">Create Page</button>
                        </div>
                    </div>
                </div>
                <div id="pages-list" class="page-list"></div>
            `;
            document.getElementById('main').innerHTML = content;
            loadPages();
        }

        // Handle our 3D points in the game world
        function loadPointsSection() {
            const content = `
                <div class="header-actions">
                    <h2>Points</h2>
                    <button class="btn-primary" onclick="showNewPointForm()">+ New Point</button>
                </div>
                <div id="point-form-container" class="form-container" style="display: none;">
                    <!-- Move your existing point form here -->
                    <div class="text-appearance-controls">
                        <!-- Add Label and Key at the top of text-appearance-controls -->
                        <div class="form-row">
                            <div class="form-group">
                                <label>Label</label>
                                <input type="text" class="form-control" id="point-label" placeholder="Display name">
                            </div>
                            <div class="form-group">
                                <label>Key</label>
                                <input type="text" class="form-control" id="point-key" placeholder="Unique identifier">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Text Size (0-5)</label>
                                <input type="range" class="range-slider" min="0" max="5" step="0.1" id="text-size" value="1">
                            </div>
                            <div class="form-group">
                                <label>Draw Distance (0-100)</label>
                                <input type="range" class="range-slider" min="0" max="100" step="1" id="draw-distance" value="50">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="text-color-group">
                                <label>Text Color</label>
                                <div class="color-preview-container">
                                    <input type="color" class="color-picker" id="text-color" value="#00f7ff">
                                </div>
                            </div>
                            <div class="text-font-group">
                                <label>Text Font</label>
                                <select class="form-control" id="font-select">
                                    <option value="1">Font 1</option>
                                    <option value="2">Font 2</option>
                                </select>
                                <div id="font-preview">Preview Text</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="points-list" class="points-list"></div>
            `;
            document.getElementById('main').innerHTML = content;
            loadPoints();
        }

        // Show all our categories in a nice grid
        async function loadCategories() {
            const categoriesList = document.getElementById('categories-list');
            const data = await loadFromJSON();
            
            if (data && data.categories) {
                const categoriesHtml = `
                    <div class="categories-grid">
                        ${data.categories.map(category => `
                            <div class="category-item" data-id="${category.id}">
                                <div class="category-header">
                                    <h3 class="category-title">${category.name}</h3>
                                    <div class="category-actions">
                                        <button class="category-edit" onclick="editCategory('${category.id}')">
                                            Edit
                                        </button>
                                        <button class="category-edit delete" onclick="deleteCategory('${category.id}')">
                                            Delete
                                        </button>
                                    </div>
                                </div>
                                <div class="category-stats">
                                    <div class="stat-item">
                                        <i>üìÑ</i> ${category.pages.length} Pages
                                    </div>
                                    <div class="stat-item">
                                        <i>üëÅÔ∏è</i> ${category.pages.filter(p => p.enabled).length} Active
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                categoriesList.innerHTML = categoriesHtml || '<div class="tip">No categories yet</div>';
            }
        }

        // Need to modify a category? We got you!
        async function editCategory(categoryId) {
            const data = await loadFromJSON();
            const category = data.categories.find(c => c.id === categoryId);
            
            if (category) {
                const newName = prompt('Enter new category name:', category.name);
                if (newName && newName.trim() !== '') {
                    category.name = newName.trim();
                    await saveToJSON(data);
                    loadCategories();
                }
            }
        }

        // Add these new functions
        function showNewPageForm(mode, pageData = null) {
            pageFormMode = mode;
            editingPageData = pageData;
            
            const formContainer = document.getElementById('page-form-container');
            const submitBtn = document.getElementById('page-submit-btn');
            
            // Clear form first
            document.getElementById('page-label').value = '';
            document.getElementById('page-key').value = '';
            document.getElementById('page-order').value = '1';
            document.getElementById('page-enabled').checked = true;
            
            formContainer.style.display = 'flex';
            
            // Initialize editor and forms
            setTimeout(async () => {
                await initializeEditor();
                await initializeForms();
                
                if (mode === 'edit' && pageData) {
                    submitBtn.textContent = 'Update Page';
                    // Fill form with existing data
                    document.getElementById('category-select').value = pageData.categoryId;
                    document.getElementById('page-label').value = pageData.label;
                    document.getElementById('page-key').value = pageData.key;
                    document.getElementById('page-order').value = pageData.order;
                    document.getElementById('page-enabled').checked = pageData.enabled;
                    if (quill) {
                        quill.root.innerHTML = pageData.content || '';
                    }
                } else {
                    submitBtn.textContent = 'Create Page';
                    if (quill) {
                        quill.root.innerHTML = '';
                    }
                }
            }, 100);
        }

        async function handlePageSubmit() {
            try {
                if (!document.getElementById('category-select').value) {
                    alert('Please select a category');
                    return;
                }

                if (pageFormMode === 'edit' && editingPageData) {
                    await updatePage(editingPageData.categoryId, editingPageData.id);
                } else {
                    await submitPage();
                }
                
                // Reset form mode and hide form
                pageFormMode = 'create';
                editingPageData = null;
                document.getElementById('page-form-container').style.display = 'none';
                
                // Reload pages list
                loadPages();
            } catch (error) {
                console.error('Error handling page submit:', error);
                alert('Error saving page');
            }
        }

        async function editPage(categoryId, pageId) {
            const data = await loadFromJSON();
            const category = data.categories.find(c => c.id === categoryId);
            const page = category?.pages.find(p => p.id === pageId);
            
            if (page) {
                showNewPageForm('edit', {
                    id: pageId,
                    categoryId: categoryId,
                    label: page.label,
                    key: page.key,
                    order: page.order,
                    enabled: page.enabled,
                    content: page.content
                });
            }
        }

        async function updatePage(categoryId, pageId) {
            try {
                const data = await loadFromJSON();
                if (!data || !data.categories) return;

                const category = data.categories.find(c => c.id === categoryId);
                if (!category || !category.pages) return;

                const pageIndex = category.pages.findIndex(p => p.id === pageId);
                if (pageIndex === -1) return;

                const updatedPage = {
                    id: pageId,
                    label: document.getElementById('page-label').value,
                    key: document.getElementById('page-key').value,
                    categoryId: document.getElementById('category-select').value,
                    order: document.getElementById('page-order').value,
                    enabled: document.getElementById('page-enabled').checked,
                    content: quill ? quill.root.innerHTML : ''
                };
                
                // Handle category change
                if (categoryId !== updatedPage.categoryId) {
                    // Remove from old category
                    category.pages.splice(pageIndex, 1);
                    // Add to new category
                    const newCategory = data.categories.find(c => c.id === updatedPage.categoryId);
                    if (newCategory) {
                        newCategory.pages.push(updatedPage);
                    }
                } else {
                    // Update in same category
                    category.pages[pageIndex] = updatedPage;
                }
                
                await saveToJSON(data);
                alert('Page updated successfully');
            } catch (error) {
                console.error('Error updating page:', error);
                alert('Error updating page');
            }
        }

        async function loadPages() {
            const pagesList = document.getElementById('pages-list');
            const data = await loadFromJSON();
            
            if (data && data.categories) {
                const categorySections = data.categories.map(category => {
                    const sortedPages = category.pages.sort((a, b) => Number(a.order) - Number(b.order));
                    
                    return `
                        <div class="category-section">
                            <h3 class="category-section-header">${category.name}</h3>
                            <div class="pages-list">
                                ${sortedPages.map(page => `
                                    <div class="page-item">
                                        <div class="page-name">${page.label}</div>
                                        <div class="page-status ${page.enabled ? 'active' : 'inactive'}">
                                            ${page.enabled ? '‚úì Active' : '√ó Inactive'}
                                        </div>
                                        <div class="page-slug">${page.key}</div>
                                        <div class="page-category">${category.name}</div>
                                        <div class="page-order">#${page.order}</div>
                                        <div class="page-actions">
                                            <button class="action-btn" onclick="editPage('${category.id}', '${page.id}')">‚úé</button>
                                            <button class="action-btn delete" onclick="deletePage('${category.id}', '${page.id}')">√ó</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
                
                pagesList.innerHTML = categorySections || '<div class="tip">No pages yet</div>';
            }
        }

        async function loadPoints() {
            const pointsList = document.getElementById('points-list');
            const data = await loadFromJSON();
            
            if (data && data.points) {
                const pointsHtml = data.points.map(point => `
                    <div class="point-item">
                        <h3>${point.label}</h3>
                        <p>Size: ${point.textSize}</p>
                        <p>Distance: ${point.drawDistance}</p>
                        <p>Color: <span style="color: ${point.textColor}">${point.textColor}</span></p>
                    </div>
                `).join('');
                
                pointsList.innerHTML = pointsHtml || '<div class="tip">No points yet</div>';
            }
        }

        async function submitPage() {
            const pageData = {
                id: Date.now().toString(),
                label: document.getElementById('page-label').value,
                key: document.getElementById('page-key').value,
                categoryId: document.getElementById('category-select').value,
                order: document.getElementById('page-order').value,
                enabled: document.getElementById('page-enabled').checked,
                content: quill.root.innerHTML
            };
            
            const data = await loadFromJSON();
            const category = data.categories.find(c => c.id === pageData.categoryId);
            if (category) {
                category.pages.push(pageData);
                await saveToJSON(data);
                
                // Clear form and hide it
                document.getElementById('page-form-container').style.display = 'none';
                document.getElementById('page-label').value = '';
                document.getElementById('page-key').value = '';
                document.getElementById('page-order').value = '1';
                
                // Reload pages list
                loadPages();
                alert('Page saved successfully');
            }
        }

        async function deletePage(categoryId, pageId) {
            if (confirm('Are you sure you want to delete this page?')) {
                const data = await loadFromJSON();
                const category = data.categories.find(c => c.id === categoryId);
                
                if (category) {
                    category.pages = category.pages.filter(p => p.id !== pageId);
                    await saveToJSON(data);
                    loadPages();
                }
            }
        }

        // Add delete function for categories
        async function deleteCategory(categoryId) {
            if (confirm('Are you sure you want to delete this category and all its pages?')) {
                const data = await loadFromJSON();
                data.categories = data.categories.filter(c => c.id !== categoryId);
                await saveToJSON(data);
                loadCategories();
            }
        }

        // Update loadSection function to cleanup editor when switching sections
        function loadSection(section) {
            cleanupEditor(); // Clean up before loading new section
            
            const main = document.getElementById('main');
            switch(section) {
                case 'categories':
                    loadCategoriesSection();
                    break;
                case 'pages':
                    loadPagesSection();
                    break;
                case 'points':
                    loadPointsSection();
                    break;
            }
        }

        // Utility functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
            
            // Toggle body scroll
            document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : '';
        }

        function zoom(direction) {
            currentZoom += direction * 10;
            currentZoom = Math.min(Math.max(currentZoom, 70), 150);
            
            const wrapper = document.querySelector('.zoom-wrapper');
            wrapper.style.transform = `scale(${currentZoom/100})`;
            wrapper.style.transformOrigin = 'center center';
        }

        function closeGuidebook() {
            if (window.confirm('Close guidebook?')) {
                window.close();
            }
        }

        async function loadFromJSON() {
            try {
                const response = await fetch('http://localhost:3000/api/data');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error loading data:', error);
                return null;
            }
        }

        async function saveToJSON(data) {
            try {
                const response = await fetch('http://localhost:3000/api/data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) throw new Error('Failed to save data');
                return data;
            } catch (error) {
                console.error('Error saving data:', error);
                alert('Error saving data');
                return null;
            }
        }

        // Add this function to initialize default data if needed
        async function initializeDefaultData() {
            const data = await loadFromJSON();
            if (!data || !data.categories) {
                const defaultData = {
                    title: "Guidebook",
                    categories: [],
                    points: []
                };
                await saveToJSON(defaultData);
            }
        }

        // Call this when the page loads
        document.addEventListener('DOMContentLoaded', initializeDefaultData);

        document.getElementById('page-form')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            const pageData = {
                id: Date.now().toString(),
                label: document.getElementById('page-label').value,
                key: document.getElementById('page-key').value,
                categoryId: document.getElementById('category-select').value,
                order: document.getElementById('page-order').value,
                enabled: document.getElementById('page-enabled').checked,
                content: quill.root.innerHTML
            };
            
            const data = await loadFromJSON();
            const category = data.categories.find(c => c.id === pageData.categoryId);
            if (category) {
                category.pages.push(pageData);
                await saveToJSON(data);
                alert('Page saved successfully');
            }
        });

        document.getElementById('point-form')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            const pointData = {
                id: Date.now().toString(),
                label: document.getElementById('point-label').value,
                key: document.getElementById('point-key').value,
                textSize: document.getElementById('text-size').value,
                drawDistance: document.getElementById('draw-distance').value,
                textColor: document.getElementById('text-color').value,
                font: document.getElementById('font-select').value,
                content: quill.root.innerHTML
            };
            
            const data = await loadFromJSON();
            data.points.push(pointData);
            await saveToJSON(data);
            alert('Point saved successfully');
        });

        async function initializeForms() {
            const data = await loadFromJSON();
            const categorySelect = document.getElementById('category-select');
            
            if (categorySelect && data.categories) {
                categorySelect.innerHTML = `
                    <option value="">Select Category</option>
                    ${data.categories.map(cat => `
                        <option value="${cat.id}">${cat.name}</option>
                    `).join('')}
                `;
            }
        }

        // Event listeners
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.querySelector('.menu-toggle');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !menuToggle.contains(event.target) &&
                sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
            }
        });

        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('active');
            }
        });

        window.addEventListener('orientationchange', function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.remove('active');
            document.body.style.overflow = '';
        });

        loadSection('categories');
    </script>
</body>
</html>

